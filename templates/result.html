<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Plagiarism Report</title>

    <link rel="stylesheet" href="/static/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        .gauge-ring {
            stroke-linecap: round;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
            transition: stroke-dashoffset 1.2s ease;
        }
    </style>
</head>

<body class="royal-theme">

<div class="container">

    <h1 class="title-gold">ğŸ“Š Premium Plagiarism Report</h1>

    {% set score = similarities[0].score * 100 %}

    <!-- GOLD SCORE GAUGE -->
    <div class="gauge-wrapper">
        <svg width="250" height="250">
            <circle cx="125" cy="125" r="100" stroke="#333" stroke-width="18" fill="none" />
            <circle id="gaugeFill" cx="125" cy="125" r="100"
                stroke="gold"
                stroke-width="18"
                fill="none"
                class="gauge-ring"
                stroke-dasharray="628"
                stroke-dashoffset="628" />
        </svg>
        <div class="gauge-label">{{ "%.0f"|format(score) }}%</div>
    </div>

    <script>
        let finalValue = {{ score }};
        let offset = 628 - (628 * finalValue / 100);
        document.addEventListener("DOMContentLoaded", () => {
            document.getElementById("gaugeFill").style.strokeDashoffset = offset;
        });
    </script>

    <!-- USER INPUT -->
    <h2 class="section-title">ğŸ“ Your Input</h2>
    <pre class="input-text">{{ input_text }}</pre>


    <!-- PIE CHART -->
    <h2 class="section-title">ğŸ“ˆ Document Similarity Breakdown</h2>

    <canvas id="similarityPie" width="300" height="300" style="margin:auto;"></canvas>

    <script>
        const docs_001 = {{ similarities | map(attribute='doc') | list | tojson }};
        const scores_001 = {{ similarities | map(attribute='score') | list | tojson }};
        const percent_001 = scores_001.map(v => v * 100);

        new Chart(document.getElementById("similarityPie"), {
            type: "pie",
            data: {
                labels: docs_001,
                datasets: [{
                    data: percent_001,
                    backgroundColor: ["#ffcc44", "#ffaa00", "#ffdd77", "#ffeeaa"]
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { labels: { color: "white" } }
                }
            }
        });
    </script>


    <!-- SIMILARITY LIST -->
    <h2 class="section-title">ğŸ“„ Similarity Scores</h2>
    <ul>
        {% for s in similarities %}
            <li class="label-gold">
                â­ {{ s.doc }} â€” {{ "%.2f"|format(s.score * 100) }}%
            </li>
        {% endfor %}
    </ul>


    <!-- HIGHLIGHTED MATCHES -->
    <h2 class="section-title">âœ¨ Highlighted Matches</h2>

    {% for h in highlights %}
        <h3 class="label-gold">{{ h.doc }} â€” {{ "%.2f" | format(h.score * 100) }}%</h3>
        <div class="highlight-box">{{ h.highlighted | safe }}</div>
    {% endfor %}


    <!-- BUTTONS -->
    <div style="text-align:center; margin-top:25px;">
        <a href="{{ url_for('index') }}">
            <button class="gold-btn">ğŸ” Check Another</button>
        </a>

        <a href="/download_pdf">
            <button class="gold-btn" style="margin-left:10px;">ğŸ“„ Download PDF Report</button>
        </a>
    </div>

</div>

</body>
</html>
