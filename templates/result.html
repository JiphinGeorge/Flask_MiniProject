<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Plagiarism Results</title>

    <link rel="stylesheet" href="/static/style.css">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        function toggleDark() {
            document.body.classList.toggle("light");
        }
    </script>
</head>

<body class="royal-theme">

<button class="theme-toggle" onclick="toggleDark()">‚òÄ</button>

<div class="container">

    <h1 class="title-gold">üìä Plagiarism Report</h1>

    <!-- FULL ROUND GAUGE -->
    {% set score = similarities[0].score * 100 %}
    <div class="gauge-wrapper">
        <canvas id="scoreGauge" width="250" height="250"></canvas>
        <div class="gauge-label">{{ '%.0f'|format(score) }}%</div>
    </div>

    <script>
        const ctx = document.getElementById("scoreGauge");
        const percentage = {{ score | round(0) }};  

        new Chart(ctx, {
            type: "doughnut",
            data: {
                labels: ["Plagiarism"],
                datasets: [{
                    data: [percentage, 100 - percentage],
                    borderWidth: 0,
                    cutout: "70%",
                    backgroundColor: [
                        percentage < 30 ? "#2ecc71" :
                        percentage < 60 ? "#f1c40f" :
                        "#e74c3c",
                        "#2b2b2b"
                    ]
                }]
            },
            options: {
                plugins: { legend: { display: false } },
                rotation: -90,
                circumference: 360
            }
        });
    </script>

    <!-- Download PDF -->
    <center>
        <a href="/download_pdf">
            <button class="gold-btn">‚¨á Download Premium PDF</button>
        </a>
    </center>

    <br><br>

    <!-- PIE CHART SECTION -->
    <h2 class="section-title">Similarity Distribution</h2>
    <canvas id="pieChart" width="350" height="350"></canvas>

    <script>
        const labels_safe = {{ similarities | map(attribute='doc') | list | tojson }};
        const scores_safe = {{ similarities | map(attribute='score') | list | tojson }};
        const scores_percent_safe = scores_safe.map(v => v * 100);

        new Chart(document.getElementById("pieChart"), {
            type: "pie",
            data: {
                labels: labels_safe,
                datasets: [{
                    data: scores_percent_safe
                }]
            }
        });
    </script>

    <!-- USER TEXT -->
    <h2 class="section-title">Your Input</h2>
    <pre class="input-text">{{ input_text }}</pre>

    <!-- SCORES LIST -->
    <h2 class="section-title">Similarity Scores</h2>
    <ul>
        {% for s in similarities %}
            <li><b>{{ s.doc }}</b> ‚Äî {{ '%.2f'|format(s.score * 100) }}%</li>
        {% endfor %}
    </ul>

    <!-- HIGHLIGHTS -->
    <h2 class="section-title">Highlighted Matches</h2>

    {% for h in highlights %}
        <h3 class="highlight-title">{{ h.doc }} ‚Äî {{ '%.2f'|format(h.score * 100) }}%</h3>
        <div class="highlight-box">{{ h.highlighted | safe }}</div>
    {% endfor %}

    <center>
        <a href="{{ url_for('index') }}"><button class="gold-btn">üîÅ Check Another</button></a>
    </center>

</div>

</body>
</html>
